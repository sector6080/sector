<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Credenziali</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        input, button {
            padding: 10px;
            margin: 5px;
            width: 200px;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #005a87;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            color: #856404;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <h1>Test API Credenziali</h1>

    <div class="test-section">
        <h2>Test Connessione API</h2>
        <button onclick="testAPI()">Test Connessione</button>
        <div id="apiResult"></div>
    </div>

    <div class="test-section">
        <h2>Test Credenziali Player</h2>
        <input type="text" id="playerUser" placeholder="Username player" value="pippo">
        <input type="password" id="playerPassword" placeholder="Password" value="seygex12">
        <button onclick="testPlayer()">Test Player</button>
        <div id="playerResult"></div>
    </div>

    <div class="test-section">
        <h2>Test Credenziali Admin</h2>
        <input type="text" id="adminUser" placeholder="Username admin" value="admin">
        <input type="password" id="adminPassword" placeholder="Password" value="123">
        <button onclick="testAdmin()">Test Admin</button>
        <div id="adminResult"></div>
    </div>

    <div class="test-section">
        <h2>Test Unità Player</h2>
        <input type="text" id="unitUser" placeholder="Username player" value="pippo">
        <button onclick="testUnit()">Test Unità</button>
        <div id="unitResult"></div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzax_zbu_DO5YI-ZrDIQ4TocaCP_ACfpPqzHhEiKDw/dev';
        const API_URL_ALT = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLj7NKo_YXXehHyAbh0Kr3SguoqO_hyHe1tf5ZIju7mbLiTNqy6n1pvVSzRbimOW_CQqLMwjx7Yq7IP97zvRfmSZeWwpI-ODWDSeLdKTobOa9dDSIDJsNSJ3L3HiaPBzCk0iQUrfV7vZArELDAV16ON5XBzy9gmFQ-yHNpO0dyoPlraYOlWTQRBev2TkF_jjnGoIK6G8eUyRyNvrP31F7XuWIcD0FDdOXv17MGgUx40U53t-HOMVFsM1x3h9L3WN-sLjuNabs4jJFX1KkRXfh-EtHG2dJA&lib=MLV1ks7wQQ37SnILDHqD1wVTcg6hxLEu9';

        async function testAPI() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<div class="loading">Test in corso...</div>';
            
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <strong>✓ API Funziona!</strong><br>
                        Dati ricevuti: ${JSON.stringify(data.data)}
                    </div>
                `;
                console.log('Dati API:', data);
            } catch (error) {
                console.error('Errore API principale:', error);
                
                // Prova con API alternativa
                try {
                    resultDiv.innerHTML = '<div class="loading">Provo API alternativa...</div>';
                    const response = await fetch(API_URL_ALT);
                    const data = await response.json();
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>✓ API Alternativa Funziona!</strong><br>
                            Dati ricevuti: ${JSON.stringify(data.data)}
                        </div>
                    `;
                    console.log('Dati API alternativa:', data);
                } catch (fallbackError) {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>✗ Errore API</strong><br>
                            Errore principale: ${error.message}<br>
                            Errore alternativa: ${fallbackError.message}
                        </div>
                    `;
                }
            }
        }

        async function testPlayer() {
            const username = document.getElementById('playerUser').value;
            const password = document.getElementById('playerPassword').value;
            const resultDiv = document.getElementById('playerResult');
            
            resultDiv.innerHTML = '<div class="loading">Verifica in corso...</div>';
            
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                const player = data.data.find(item => 
                    item.user && item.password && 
                    item.user === username && item.password === password
                );
                
                if (player) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>✓ Credenziali Player Valide!</strong><br>
                            Username: ${player.user}<br>
                            Unità: ${player.unita || 'N/A'}<br>
                            Dati completi: ${JSON.stringify(player)}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>✗ Credenziali Player Non Valide</strong><br>
                            Username: ${username}<br>
                            Password: ${password}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>✗ Errore durante la verifica</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        async function testAdmin() {
            const username = document.getElementById('adminUser').value;
            const password = document.getElementById('adminPassword').value;
            const resultDiv = document.getElementById('adminResult');
            
            resultDiv.innerHTML = '<div class="loading">Verifica in corso...</div>';
            
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                const admin = data.data.find(item => 
                    item.user_admin && item.password_admin && 
                    item.user_admin === username && item.password_admin === password
                );
                
                if (admin) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>✓ Credenziali Admin Valide!</strong><br>
                            Username: ${admin.user_admin}<br>
                            Dati completi: ${JSON.stringify(admin)}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>✗ Credenziali Admin Non Valide</strong><br>
                            Username: ${username}<br>
                            Password: ${password}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>✗ Errore durante la verifica</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        async function testUnit() {
            const username = document.getElementById('unitUser').value;
            const resultDiv = document.getElementById('unitResult');
            
            resultDiv.innerHTML = '<div class="loading">Ricerca unità...</div>';
            
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                const player = data.data.find(item => item.user === username);
                
                if (player) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>✓ Player Trovato!</strong><br>
                            Username: ${player.user}<br>
                            Unità associata: ${player.unita || 'Nessuna unità'}<br>
                            Dati completi: ${JSON.stringify(player)}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>✗ Player Non Trovato</strong><br>
                            Username: ${username}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>✗ Errore durante la ricerca</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        // Test automatico al caricamento della pagina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Pagina caricata - pronta per i test');
        });
    </script>
</body>
</html>